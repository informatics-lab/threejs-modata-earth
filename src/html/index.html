<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Met Office :: Global Temperature Visualisation</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css"/>
    <script type="text/javascript" src="js/lib/three.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="HandheldFriendly" content="true" />
</head>
<body>

<div id="incompatible" style="display: none;">
    <div class="wrapper">
        <div class="combinedlogo">
            <img src="img/met-office-logo.svg" class="moLogo" alt="Met Office"/>
            <h2 class="infoLabLogo">Informatics Lab</h2>
        </div>
        <h3>Incompatible browser</h3>
        <div class="infotext">
            <p>This prototype visualisation requires a number of new and experimental browser features
                which only work with certain modern browsers in the desktop environment.</p>
            <p>Please use one of the following browsers:</p>
            <ul>
                <li>Chrome (Desktop) >= 53</li>
                <li>Firefox (Desktop) >= 49</li>
                <li>Safari (Desktop) >= 9</li>
            </ul>
        </div>
        <p>
            Alternatively you can <a id='goWithNotCompatible' href='#'>proceed anyway.</a>
        </p>
    </div>
</div>

<div id="loading">
    <div class="wrapper">
        <div class="combinedlogo">
            <img src="img/met-office-logo.svg" id="moLogo" alt="Met Office"></img>
            <h2 id="infoLabLogo">Informatics Lab</h2>
        </div>
        <h3 id="hadcrut4logo">Global Temperature</h3>
        <div id="hadcrut4text">
            <p>This prototype visualisation uses the <a href="http://www.metoffice.gov.uk/hadobs/hadcrut4/">HadCRUT4</a> dataset, a collection of global surface temperature since 1850, which uses data from the Met Office Hadley Centre and the Climatic Research Unit at UEA.</p>
            <p>In this visualisation you can explore this surface temperature data, and some of the global events which have affected it.</p>
            <p>Temperatures are expressed as the difference from average temperature between 1961-1990.</p>
        </div>
    </div>
</div>

<div id="content"></div>

<div id="info">
    <h3><span>&#8505</span> Global Temperature Visualisation Information</h3>
    <p>This prototype visualisation uses the <a href="http://www.metoffice.gov.uk/hadobs/hadcrut4/">HadCRUT4</a> dataset, a collection of global surface temperature since 1850, which uses data from the Met Office Hadley Centre and the Climatic Research Unit at UEA.</p>
    <p>In this visualisation you can explore this surface temperature data, and some of the global events which have affected it.</p>
    <p>Temperatures are expressed as the difference from average temperature between 1961-1990.</p>
    <p>More advanced controls are available by pressing 'h' on the keyboard.</p>
</div>

<!-- ---------------- Custom Shader Code ------------------------ -->
<script id="glowVertexShader" type="x-shader/x-vertex">
varying vec3 vNormal;
void main()
{
    vNormal = normalize( normalMatrix * normal );
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}

</script>

<script id="glowFragmentShader" type="x-shader/x-vertex">
varying vec3 vNormal;
void main()
{
	float intensity = pow( 0.7 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 4.0 );
    gl_FragColor = vec4( 0.57, 0.80, 0.04, 1.0 ) * intensity;
}

</script>


<script id="cloudVertexShader" type="x-shader/x-vertex">
      #define textureSize 128.0
      #define texelSize 1.0 / 2048.0
      vec4 texture2D_bilinear( sampler2D tex, vec2 uv )
      {
        vec2 f = fract( uv.xy * textureSize );
        vec4 t00 = texture2D( tex, uv );
        vec4 t10 = texture2D( tex, uv + vec2( texelSize, 0.0 ));
        vec4 tA = mix( t00, t10, f.x );
        vec4 t01 = texture2D( tex, uv + vec2( 0.0, texelSize ) );
        vec4 t11 = texture2D( tex, uv + vec2( texelSize, texelSize ) );
        vec4 tB = mix( t01, t11, f.x );
        return mix( tA, tB, f.y );
      }

      uniform sampler2D textureClouds;
      uniform float height;
      varying vec3 vNormal;
      varying vec2 vUv;

      void main() {
        vec4 newVertexPos;
        vec4 dv;
        float df;

        //  this looks up the color from the texture and applies a transform for the vertex
        dv = texture2D_bilinear( textureClouds, uv.xy );
        df = 0.30*dv.x + 0.59*dv.y + 0.11*dv.z;

        //  we do this to round out the cloud vertex push
        df = sqrt(df);
        newVertexPos = vec4(normal * df * height, 0.0);

        //  add the final position for the vertex
        newVertexPos += vec4( position, 1.0);

        //  now place it where it should be on screen
        gl_Position = projectionMatrix * modelViewMatrix * newVertexPos;

        vNormal = normalize( normalMatrix * normal );
        vUv = uv;
      }

</script>

<script id="cloudFragmentShader" type="x-shader/x-fragment">
      uniform sampler2D textureClouds;
      uniform float edgeFade;
      varying vec3 vNormal;
      varying vec2 vUv;
      void main() {

        //  fade out at the edges when drawn onto globe
        float intensity = dot( vNormal, vec3(0.0, -0.05, 2.5 - edgeFade ) );

        //  cap the values, but also power it up
        intensity = clamp( pow( intensity, 22.0), 0.0, 1.0 )  ;

        //  look up the texture color
        vec3 diffuse = texture2D( textureClouds, vUv ).xyz;

        //  blend it with the texture color
        //intensity = intensity * diffuse.x;
        intensity = 1.5 * diffuse.x;

        //  cap the final value
        float finalColor = clamp( intensity, 0.0, 1.0 );

        gl_FragColor = vec4( finalColor );
        if(intensity < 0.3) {
            gl_FragColor.a = 0.0;
        }
      }

</script>
<!-- ----------------------------------------------------------- -->
<script type="text/javascript" src="js/app.min.js"></script>

<!-- GOOGLE ANALYTICS -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60337429-4', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>